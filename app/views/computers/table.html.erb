<%= render "shared/page_title", title: "Computer Index Table" %>

<!-- Calculates the # of computers in stock, processed, & unprocessed -->
<% c_count = 0 %><% p_count = 0 %>
<% @computers.each do |computer| %>
  <% c_count += 1 %>
  <% if computer.wipe and computer.wipe.action_taken.length > 0 %>
    <% p_count += 1 %>
  <% end %>
<% end %>

<div class="row">
  <div class="col-md-6 col-md-offset-3 text-center">
    <p>
      Computers in stock: <strong><%= c_count %></strong> |
      Computers processed: <strong><%= p_count %></strong> |
      Computers unprocessed: <strong><%= c_count - p_count %></strong>
    </p>
  </div>
</div>
<hr>

<!-- Search bar -->
<div class="row">
  <div class="col-md-6 col-md-offset-3 center">
    <%= form_tag(computertable_path, :method => "get", id: "search-form") do %>
      <%= label_tag :search, "Search by TuringTrack, Serial No, Product Key, or Manufacturer" %>
      <%= text_field_tag :search, params[:search], placeholder: "Search Manufacturers" %>
      <strong><%= submit_tag "Search" %></strong>
    <% end %>
  </div>
</div>
<hr>

<!-- Computer details table -->
<% if @computers.present? %>

  <div class="row">
    <div class="col-md-12">
      <table class="table table-bordered table-hover">
        <thead>
          <tr>
            <th class="text-center">Turing Track</th>
            <th>Manufacturer</th>
            <th>Computer Type</th>
            <th>Model No.</th>
            <th>Serial No.</th>
            <th>OS Product Key</th>
            <th>Donor</th>
            <th>Created At</th>
            <th>Updated At</th>
            <th>Wiped?</th>
            <th>Wiped by</th>
            <th>Wiped on</th>
            <th>Shipped?</th>
            <th>Received?</th>
          </tr>
        </thead>
        <tbody>
          <% @computers.each do |computer| %>
          <% if computer.wipe.present? %> <tr> <% else %> <tr class="danger"> <% end %>
              <td><%= link_to "#" + computer.turingtrack, computer_path(computer) %></td>
              <td><%= computer.manufacturer %></td>
              <td><%= computer.computer_type %></td>
              <td><%= computer.model_no %></td>
              <td><%= computer.serial_no %></td>
              <td><%= computer.product_key %></td>
              <td><%= link_to computer.donor.donor_name, donor_path(computer.donor) %></td>
              <td><%= computer.created_at.strftime("%d/%m/%y") %></td>
              <td><%= computer.updated_at.strftime("%d/%m/%y") %></td>
              
              <% if computer.wipe.present? and  computer.wipe.action_taken.length > 0  %>
                <td><%= link_to "Yes", wipe_path(computer.wipe) %></td>
                <td><%= link_to computer.wipe.staff.staff_name, staff_path(computer.wipe.staff) %></td>
                <td><%= computer.wipe.created_at.strftime("%d/%m/%y") %></td>
              <% else %>
                <td>No</td>
                <td>-</td>
                <td>-</td>
              <% end %>
              
              <% if computer.shipment.present? and computer.shipment.shipped %>
                <td><%= link_to "Yes", shipment_path(computer.shipment) %>
              <% else %>
                <td><%= link_to "No", new_shipment_path %></td>
              <% end %>
              
              <% if computer.receipt.present? and computer.receipt.received %>
                <td><%= link_to "Yes", receipt_path(computer.receipt) %>
              <% else %>
                <td><%= link_to "No", new_receipt_path %></td>
              <% end %>
              
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>

<% else %>

<!-- Warning for empty search results -->
<hr>
<div class="row">
  <div class="col-md-6 col-md-offset-3 center">
    <h4>There are no records containing the term: <%= params[:search] %></h4>
  </div>
</div>
<hr>
  
<% end %>

<div class="row">
  <div class="col-md-2 col-md-offset-5 center">
     <%= link_to "Return to Computer Index", computertable_path, class: "btn btn-success btn-small" %>
  </div>
</div>